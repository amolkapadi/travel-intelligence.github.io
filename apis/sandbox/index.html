---
layout: default
title: Sandbox
---

<!-- Navigation Bars -->
<div id="firstNavigationBar"></div>
<div id="secondNavigationBar"></div>
<div id="thirdNavigationBar"></div>
<script src="/javascripts/navigation-bar.js"></script>

<!-- Sandbox Navigation Bar -->
<div id="title"></div>
<div id="forthNavigationBar"></div>

<!-- Form -->
<div id="form"></div>

<!-- On Load Actions -->
<body onLoad="computeFirstNavigationBar(); computeSecondNavigationBar(); computeThirdNavigationBar(); computeSandboxTitle(); computeForthNavigationBar(); computeForm();"></body>


<!-- Javascript -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>
function computeSandboxTitle() {
  var previousPage = document.referrer;
  if (previousPage.indexOf("authentication.html") != -1) {
    htmlCode = '<div id="api">  <h1>Authentication</h1></div>';
  }
  else if (previousPage.indexOf("search-look-hits.html") != -1) {
    htmlCode = '<div id="api">  <h1>Search hits by look date API</h1></div>';
  }
  else if (previousPage.indexOf("search-travel-hits.html") != -1) {
    htmlCode = '<div id="api">  <h1>Search hits by travel date API</h1></div>';  
  }
  else if (previousPage.indexOf("search-hit-evolutions.html") != -1) {
    htmlCode = '<div id="api">  <h1>Search hit evolutions API</h1></div>';
  }
  else if (previousPage.indexOf("search-hit-variations.html") != -1) {
    htmlCode = '<div id="api">  <h1>Search hit variations API</h1></div>';  
  }
  else if (previousPage.indexOf("booking-analysis-evolution.html") != -1) {
    htmlCode = '<div id="api">  <h1>Travel Agency Booking Analysis API - evolution</h1></div>';  
  }
  else if (previousPage.indexOf("booking-analysis-top-airlines.html") != -1) {
    htmlCode = '<div id="api">  <h1>Travel Agency Booking Analysis API - top airlines</h1></div>';
  }
  else if (previousPage.indexOf("booking-analysis-top-countries.html") != -1) {
    htmlCode = '<div id="api">  <h1>Travel Agency Booking Analysis API - top countries</h1></div>';  
  }
  else if (previousPage.indexOf("booking-analysis-top-onds.html") != -1) {
    htmlCode = '<div id="api">  <h1>Travel Agency Booking Analysis API - top O&Ds</h1></div>';
  }
  else if (previousPage.indexOf("booking-analysis-total.html") != -1) {
    htmlCode = '<div id="api">  <h1>Travel Agency Booking Analysis API - total per agency</h1></div>';
  }
  else if (previousPage.indexOf("por-search.html") != -1) {
    htmlCode = '<div id="api">  <h1>Point of Reference search API</h1></div>';
  }
  else if (previousPage.indexOf("booking-market-search.html") != -1) {
    htmlCode = '<div id="api">  <h1>Booking Market search API</h1></div>';
  }
  else if (previousPage.indexOf("pos-search.html") != -1) {
    htmlCode = '<div id="api">  <h1>Point of Sales search API</h1></div>';
  }
  else if (previousPage.indexOf("airline-search.html") != -1) {
    htmlCode = '<div id="api">  <h1>Airline search API</h1></div>';
  }
  else if (previousPage.indexOf("pricebenchmark_advancedpurchase.html") != -1) {
    htmlCode = '<div id="api">  <h1>PriceBenchmark API - AdvancedPurchase</h1></div>';
  }
  else if (previousPage.indexOf("pricebenchmark_bestpriceairline.html") != -1) {
    htmlCode = '<div id="api">  <h1>PriceBenchmark API - BestPriceAirline</h1></div>';
  }
  else if (previousPage.indexOf("pricebenchmark_farenegotiation.html") != -1) {
    htmlCode = '<div id="api">  <h1>PriceBenchmark API - FareNegotiation</h1></div>';
  }
  else if (previousPage.indexOf("pricebenchmark_fareparams.html") != -1) {
    htmlCode = '<div id="api">  <h1>PriceBenchmark API - FareParams</h1></div>';
  }
  else if (previousPage.indexOf("pricebenchmark_fareprojection.html") != -1) {
    htmlCode = '<div id="api">  <h1>PriceBenchmark API - FareProjection</h1></div>';
  }
  else if (previousPage.indexOf("pricebenchmark_faresnapshot.html") != -1) {
    htmlCode = '<div id="api">  <h1>PriceBenchmark API - AdvancedPurchase</h1></div>';
  }
  else if (previousPage.indexOf("pricebenchmark_purchasesnapshot.html") != -1) {
    htmlCode = '<div id="api">  <h1>PriceBenchmark API - PurchaseSnapshot</h1></div>';
  }
  else if (previousPage.indexOf("schedule-airline-top.html") != -1) {
    htmlCode = '<div id="api">  <h1>Schedule Analysis API - Airline_Top</h1></div>';
  }
  else if (previousPage.indexOf("schedule-flight-changes.html") != -1) {
    htmlCode = '<div id="api">  <h1>Schedule Analysis API - Flight Changes</h1></div>';
  }
  else if (previousPage.indexOf("schedule-flights.html") != -1) {
    htmlCode = '<div id="api">  <h1>Schedule Analysis API - Flights</h1></div>';
  }
  else if (previousPage.indexOf("schedule-slots.html") != -1) {
    htmlCode = '<div id="api">  <h1>Schedule Analysis API - Slots</h1></div>';
  }
  else {
    htmlCode = '';
  }
  document.getElementById('title').innerHTML = htmlCode;  
}

function computeForthNavigationBar() {
  var previousPage = document.referrer;
  htmlCode = '<div id="nav4" class="main-nav4"><ul> <li><a href="' + previousPage + '">Description</a></li> <li class="current"><a href="#">Sandbox</a></li> </ul></div>';
  document.getElementById('forthNavigationBar').innerHTML = htmlCode;  
}

function computeForm() {
  var previousPage = document.referrer;

  htmlCode = '<p></p> <table><tr><td><form id="formularSandbox"> <fieldset class="formular"> <legend>Input Parameters</legend>';

  if (previousPage.indexOf("authentication.html") != -1) {
    htmlCode = htmlCode + '<p>Email: *<br><input type="email" name="email" size=30 required placeholder="Email" title="Email"></p> <p>Password: *<br><input type="password" name="password" size=30 required placeholder="Password" title="Password"></p>';

    htmlCode = htmlCode + '</fieldset> <p><input type="button" style="color: white; background-color: #005Eb8;" value="Submit" onClick="checkInputs(); getResults();"></p> </form> </td> <td> <fieldset class="formular"> <legend>Result</legend> <iframe id="resultFrame" style="border: 0; width:655px; height:90px;"></iframe> </fieldset> </td> </tr> </table>';
  }
  else {
    if (previousPage.indexOf("search-look-hits.html") != -1 || previousPage.indexOf("search-travel-hits.html") != -1 || previousPage.indexOf("search-hit-evolutions.html") != -1 || previousPage.indexOf("search-hit-variations.html") != -1) {
      htmlCode = htmlCode + '<p>Market: *<br><input type="text" name="market" maxlength=2 required value="FR" placeholder="Market" title="2-letters IATA country code of the point of sale"></p>';
    }
    if (previousPage.indexOf("search-look-hits.html") != -1 || previousPage.indexOf("search-travel-hits.html") != -1) {
      htmlCode = htmlCode + '<p>Month: *<br><input type="text" name="month" maxlength=7 required value="2012-01" placeholder="Month (yyyy-mm)" title="Month of look date formatted as YYYY-MM"></p>';
    }
    if (previousPage.indexOf("search-look-hits.html") != -1 || previousPage.indexOf("search-travel-hits.html") != -1 || previousPage.indexOf("search-hit-evolutions.html") != -1) {
      htmlCode = htmlCode + '<p>Origin:<br><input type="text" name="origin" maxlength=3 placeholder="Origin" title="3-letters IATA code of the departure city"></p> <p>Destination:<br><input type="text" name="destination" maxlength=3 placeholder="Destination" title="3-letters IATA code of the arrival city"></p>';
    }
    if (previousPage.indexOf("search-travel-hits.html") != -1) {
      htmlCode = htmlCode + '<p>Weekends:<br><input list="we_true" name="weekends" maxlength=4 placeholder="Only weekends?" title="Set to true to restrict on weekend trips"><datalist id="we_true"><option value="true"></datalist></p> ';
    }
    if (previousPage.indexOf("search-hit-variations.html") != -1) {
      htmlCode = htmlCode + '<p>Month a: *<br><input type="text" name="month_a" maxlength=7 required value="2011-11" placeholder="Month a" title="Month of interest for the travel date (YYYY-MM)"></p><p>Month b: *<br><input type="text" name="month_b" maxlength=7 required value="2011-10" placeholder="Month b" title="Month to be compared with, as travel date (YYYY-MM)"></p>';
    }
    if (previousPage.indexOf("booking-analysis-evolution.html") != -1 || previousPage.indexOf("booking-analysis-top-airlines.html") != -1 || previousPage.indexOf("booking-analysis-top-countries.html") != -1 || previousPage.indexOf("booking-analysis-top-onds.html") != -1 || previousPage.indexOf("booking-analysis-total.html") != -1) {
      htmlCode = htmlCode + '<p>Period: *<br><input type="text" name="booking_period" placeholder="Booking Period" title="to select the bookings that were performed during a period"><br><input type="text" name="departure_period" placeholder="Departure Period" title="to select the bookings for flights leaving during a period"></p> <p>Limit in days: <input type="number" name="limit_in_days" min=1 max=365 step=1 title="Number of days to consider from the start of the period"></p> <p>Origin:<br><input type="text" name="origin_city" maxlength=3 placeholder="Origin City" title="IATA code of the departure city of the O&D"> <br><input type="text" name="origin_port" maxlength=3 placeholder="Origin Airport" title="IATA code of the departure airport of the O&D"><br><input type="text" name="origin_country" maxlength=2 placeholder="Origin Country" title="IATA code of the departure country of the O&D"></p> <p>Destination:<br><input type="text" name="destination_city" maxlength=3 placeholder="Destination City" title="IATA code of the arrival city of the O&D"><br><input type="text" name="destination_port" maxlength=3 placeholder="Destination Airport" title="IATA code of the arrival airport of the O&D"><br><input type="text" name="destination_country" maxlength=2 placeholder="Destination Country" title="IATA code of the arrival country of the O&D"></p> <p>POS:<br><input type="text" name="pos_oid" placeholder="POS Office Id" title="Office ID of the point of sale"><br><input type="text" name="pos_country" maxlength=2 placeholder="POS Country" title="Country IATA code of the point of sale"></p> <p>Marketing Carrier:<br><input type="text" name="marketing_carrier" maxlength=3 placeholder="Marketing Carrier" title="IATA code of the marketing carrier"></p> <p>Cabin Class:<br><input type="text" name="cabin_class" maxlength=1 placeholder="Cabin Class" title="1-letter code for the cabin class"></p>';
    }
    if (previousPage.indexOf("booking-analysis-top-airlines.html") != -1 || previousPage.indexOf("booking-analysis-top-countries.html") != -1 || previousPage.indexOf("booking-analysis-top-onds.html") != -1) {
      htmlCode = htmlCode + '<p>Sort by:<br><input list="sort" name="sort_by" placeholder="Sort by?" title="Agency types taken as sort criterion for top_onds, top_airlines and top_countries"><datalist id="sort"><option value="travel_agency"><option value="competition"><option value="market"></datalist></p>';
    }
    if (previousPage.indexOf("pricebenchmark_fareparams.html") != -1 || previousPage.indexOf("pricebenchmark_farenegotiation.html") != -1 || previousPage.indexOf("pricebenchmark_advancedpurchase.html") != -1 || previousPage.indexOf("pricebenchmark_bestpriceairline.html") != -1 || previousPage.indexOf("pricebenchmark_fareprojection.html") != -1 || previousPage.indexOf("pricebenchmark_faresnapshot.html") != -1 || previousPage.indexOf("pricebenchmark_purchasesnapshot.html") != -1) {
      htmlCode = htmlCode + '<p>Fare or File Type: *<br><input list="fare_type" name="faretype" placeholder="Fare Type" title="Public or private fares to be queried"><br><input list="fare_type" name="filetype" placeholder="File Type" title="Public or private fares to be queried"><datalist id="fare_type"><option value="public"><option value="private"></datalist></p>';
    }
    if (previousPage.indexOf("pricebenchmark_farenegotiation.html") != -1 || previousPage.indexOf("pricebenchmark_advancedpurchase.html") != -1 || previousPage.indexOf("pricebenchmark_bestpriceairline.html") != -1 || previousPage.indexOf("pricebenchmark_fareprojection.html") != -1 || previousPage.indexOf("pricebenchmark_faresnapshot.html") != -1 || previousPage.indexOf("pricebenchmark_purchasesnapshot.html") != -1) {
      htmlCode = htmlCode + '<p>Customer: *<br><input type="text" name="customer" maxlength=20 placeholder="Customer" title="OfficeID to be queried" required></p> <p>Travel Start: *<br><input type="number" name="travel_start" maxlength=8 placeholder="YYYYMMDD" title="First travel start date to use. Format YYYYMMDD" required></p>';
    }
    if (previousPage.indexOf("pricebenchmark_farenegotiation.html") != -1 || previousPage.indexOf("pricebenchmark_advancedpurchase.html") != -1 || previousPage.indexOf("pricebenchmark_bestpriceairline.html") != -1 || previousPage.indexOf("pricebenchmark_fareprojection.html") != -1 || previousPage.indexOf("pricebenchmark_faresnapshot.html") != -1) {
      htmlCode = htmlCode + '<p>Travel End: *<br><input type="number" name="travel_end" maxlength=8 placeholder="YYYYMMDD" title="Last travel start date to use. Format YYYYMMDD" required></p>';
    }
    if (previousPage.indexOf("pricebenchmark_farenegotiation.html") != -1 || previousPage.indexOf("pricebenchmark_advancedpurchase.html") != -1 || previousPage.indexOf("pricebenchmark_bestpriceairline.html") != -1 || previousPage.indexOf("pricebenchmark_fareprojection.html") != -1) {
      htmlCode = htmlCode + '<p>Advanced Purchase Days: *<br><input type="text" name="advancedpurchasedays" maxlength=20 placeholder="Advanced Purchase Days" title="Advanced purchases to query." required></p>';
    }
    if (previousPage.indexOf("pricebenchmark_farenegotiation.html") != -1 || previousPage.indexOf("pricebenchmark_advancedpurchase.html") != -1 || previousPage.indexOf("pricebenchmark_bestpriceairline.html") != -1 || previousPage.indexOf("pricebenchmark_purchasesnapshot.html") != -1) {
      htmlCode = htmlCode + '<p>Departure Week Days: *<br><input type="text" name="depweekdays" maxlength=20 placeholder="Departure Week Days" title="Can be used to reduce the results to specified week days (1-7, monday-sunday)." required></p>';
    }
    if (previousPage.indexOf("pricebenchmark_advancedpurchase.html") != -1 || previousPage.indexOf("pricebenchmark_bestpriceairline.html") != -1 || previousPage.indexOf("pricebenchmark_fareprojection.html") != -1 || previousPage.indexOf("pricebenchmark_faresnapshot.html") != -1 || previousPage.indexOf("pricebenchmark_purchasesnapshot.html") != -1) {
      htmlCode = htmlCode + '<p>Origin: *<br><input type="text" name="origin" maxlength=3 placeholder="Origin" title="3-letters IATA code of the departure city" required></p> <p>Destination: *<br><input type="text" name="destination" maxlength=3 placeholder="Destination" title="3-letters IATA code of the arrival city" required></p> <p>Cabin Class: *<br><input type="text" name="cabinclass" maxlength=1 placeholder="Cabin Class" title="1-letter code for the cabin class" required></p> <p>Trip Duration:<br><input type="number" name="tripduration" placeholder="Trip Duration" title="Trip duration to be queried" required></p> <p>Airline:<br><input type="text" name="airline" placeholder="Airline" title="Airline code to be queried"></p>';
    }
    if (previousPage.indexOf("pricebenchmark_faresnapshot.html") != -1) {
      htmlCode = htmlCode + '<p>Booking Start: *<br><input type="number" name="booking_start" maxlength=8 placeholder="YYYYMMDD" title="Pricing date to use. Format YYYYMMDD" required></p>';
    }
    if (previousPage.indexOf("pricebenchmark_advancedpurchase.html") != -1 || previousPage.indexOf("pricebenchmark_bestpriceairline.html") != -1) {
      htmlCode = htmlCode + '<p>Export:<br><input list="export_type" name="export" maxlength=3 placeholder="Export Type" title="Used to force CSV results to be returned. Default: JSON if parameter omitted"><datalist id="export_type"><option value="csv"></datalist></p>';
    }
    if (previousPage.indexOf("pricebenchmark_advancedpurchase.html") != -1 || previousPage.indexOf("pricebenchmark_fareprojection.html") != -1 || previousPage.indexOf("pricebenchmark_faresnapshot.html") != -1 || previousPage.indexOf("pricebenchmark_purchasesnapshot.html") != -1) {
      htmlCode = htmlCode + '<p>Summary Type:<br><input list="summary_type_list" name="summary_type" maxlength=10 placeholder="Summary Type" title="Used to specify aggregation level (daily, monthly, quarterly) Default: daily"><datalist id="summary_type_list"><option value="daily"><option value="monthly"><option value="quarterly"></datalist></p>';
    }
    if (previousPage.indexOf("search-look-hits.html") != -1 || previousPage.indexOf("search-travel-hits.html") != -1 || previousPage.indexOf("search-hit-evolutions.html") != -1 || previousPage.indexOf("search-hit-variations.html") != -1 || previousPage.indexOf("booking-analysis-evolution.html") != -1 || previousPage.indexOf("booking-analysis-top-airlines.html") != -1 || previousPage.indexOf("booking-analysis-top-countries.html") != -1 || previousPage.indexOf("booking-analysis-top-onds.html") != -1 || previousPage.indexOf("booking-analysis-total.html") != -1 || previousPage.indexOf("pricebenchmark_fareparams.html") != -1 || previousPage.indexOf("pricebenchmark_farenegotiation.html") != -1 || previousPage.indexOf("pricebenchmark_advancedpurchase.html") != -1 || previousPage.indexOf("pricebenchmark_bestpriceairline.html") != -1 || previousPage.indexOf("pricebenchmark_fareprojection.html") != -1 || previousPage.indexOf("pricebenchmark_faresnapshot.html") != -1 || previousPage.indexOf("pricebenchmark_purchasesnapshot.html") != -1) {
      htmlCode = htmlCode + '<p>Token: *<br><input type="text" name="auth_token" maxlength=20 required value="' + localStorage.getItem('authorisation_token') + '" placeholder="Authorisation Token" title="Token to get authorised access to the webservice"></p>';
    }
    
    hltmlCode = htmlCode + '<p><input type="hidden" name="format" required value="json"></p>';
    htmlCode = htmlCode + '</fieldset> <p><input type="button" style="color: white; background-color: #005Eb8;" value="Submit" onClick="checkInputs(); getResults();"></p> </form> </td> <td> <fieldset class="formular"> <legend>URL</legend> <iframe id="urlFrame" style="border: 0; width:700px; height:40px;"></iframe> </fieldset> <p></p> <fieldset class="formular"> <legend>Result</legend> <iframe id="resultFrame" style="border: 0; width:700px; height:500px;"></iframe> </fieldset> </td> </tr> </table>';
  }
  document.getElementById('form').innerHTML = htmlCode;
}

function checkInputs() {
  var form = document.getElementById("formularSandbox");
  var linkBetweenPatternsAndFields = [
    [/^[a-zA-Z0-9._-]+@[a-z0-9._-]{2,}\.[a-z]{2,4}$/, ["email"]],
    [/^[A-z]{2}$/, ["market", "origin_country", "destination_country", "pos_country"]],
    [/^[A-z]{3}$/, ["origin", "destination", "origin_city", "origin_port", "destination_city", "destination_port"]],
    [/^[A-z0-9]$/, ["pos_oid", "faretype", "filetype", "customer", "export", "summary_type"]],
    [/^[A-z0-9]{2,3}$/, ["marketing_carrier", "airline"]],
    [/^[A-z]{1}$/, ["cabin_class", "cabinclass"]],
    [/^(true)$/, ["weekends"]],
    [/^[0-9]{1,3}$/, ["limit_in_days", "advancedpurchasedays", "depweekdays", "tripduration"]],
    [/^[0-9]{8}$/, ["travel_start", "travel_end", "booking_start"]],
    [/^(travel_agency|competition|market)$/, ["sort_by"]],
    [/^(20[0-9]{2}\-(0[1-9]|1[0-2]))$/, ["month", "month_a", "month_b"]],
    [/^((20[0-9]{2}(\,20[0-9]{2})?)|(20[0-9]{2}\-Q[1-4](\,20[0-9]{2}\-Q[1-4])?)|(20[0-9]{2}\-(0[1-9]|1[0-2])(\,20[0-9]{2}\-(0[1-9]|1[0-2]))?)|(20[0-9]{2}\-W[1-53](\,20[0-9]{2}\-W[1-53])?))$/, ["booking_period"]],
    [/^((20[0-9]{2}(\,20[0-9]{2})?)|(20[0-9]{2}\-Q[1-4](\,20[0-9]{2}\-Q[1-4])?)|(20[0-9]{2}\-(0[1-9]|1[0-2])(\,20[0-9]{2}\-(0[1-9]|1[0-2]))?)|(20[0-9]{2}\-W[1-53](\,20[0-9]{2}\-W[1-53])?)|(20[0-9]{2}\-(0[1-9]|1[0-2])\-(0[1-9]|[12][0-9]|3[01]) (\,20[0-9]{2}\-(0[1-9]|1[0-2])\-(0[1-9]|[12][0-9]|3[01]))?))$/, ["departure_period"]]
  ];
  //Loop over each pattern (email, 2-letters fields, etc) to be checked
  for (var i = 0; i < linkBetweenPatternsAndFields.length; i++) {
    var pattern = linkBetweenPatternsAndFields[i][0];
    var fieldsStringsArray = linkBetweenPatternsAndFields[i][1];
    //Loop over each field to be tested
    for (var j = 0; j < fieldsStringsArray.length; j++) {
      var field = form.elements[fieldsStringsArray[j]];
      //If the field exist in the current formular
      if (field != null) {
        //Filled field: test the format
        if (field.value!="") {
          if (!pattern.test(field.value))
            highlight(field, true);
          else
            highlight(field, false);
        }
        //Empty field: check if required
        else {
          if (field.required==true)
            highlight(field, true);
          else
            highlight(field, false);
        }
      }
    }
  }
  //Special check for the required field booking_period or departure_period, faretype or filetype
  var field_1, field_2;
  for (var i=0; i<2; i++)
  {
    if (i == 0) {
      field_1 = form.elements["booking_period"];
      field_2 = form.elements["departure_period"];
    }
    else {
      field_1 = form.elements["faretype"];
      field_2 = form.elements["filetype"];
    }

    if (field_1 != null && field_2 != null) {
      if ((field_1.value == '' && field_2.value == '') || (field_1.value != '' && field_2.value != '')) {
        highlight(field_1, true);
        highlight(field_2, true);
      }
      else {
        highlight(field_1, false);
        highlight(field_2, false);
      }
    }
  }
}

function highlight(field, error) {
  if (error) {
    field.style.borderColor = "#CE0058";
    field.style.borderStyle = "solid";
  }
  else {
    field.style.borderColor = "";
    field.style.borderStyle = "";
  }
}

function getResults() {
  var previousPage = document.referrer;
  var form = document.getElementById("formularSandbox");
  var frameRes = document.getElementById('resultFrame');
  frameRes.contentDocument.body.style.fontSize = "10px";
  frameRes.contentDocument.body.style.fontFamily = "verdana, sans-serif";
  frameRes.contentDocument.body.style.whiteSpace = 'pre';

  if (previousPage.indexOf("authentication.html") != -1) {
    // Get the inputed email and password
    var inputs = $.parseJSON('{"session":{"email":"' + form.elements["email"].value + '", "password":"' + form.elements["password"].value + '"}}');
    // Post the http request
    $.post("https://demo.travel-intelligence.com/api/v1/session", inputs)
      .fail(function(jqXHR, textStatus, errorThrown) {
        frameRes.contentDocument.body.innerHTML ='Authentication request failed! ' + errorThrown;
      })
      .done(function(data) {
        var jsonString = JSON.stringify(data, null, '\t');
        frameRes.contentDocument.body.innerHTML = jsonString;
        // Store the constant "authorisation_token" locally, for later reuse by all the forms
        localStorage.setItem('authorisation_token', data.session.auth_token);
      });
  }
  else {
    // If a token has been directly entered in the formular, store it locally in the constant "authorisation_token", for later reuse by all the forms
    if (form.elements["auth_token"].value != "") {
      localStorage.setItem('authorisation_token', form.elements["auth_token"].value);
    }
    // Build the url
    var url = "";
    if (previousPage.indexOf("search-look-hits.html") != -1 || previousPage.indexOf("search-travel-hits.html") != -1 || previousPage.indexOf("search-hit-evolutions.html") != -1 || previousPage.indexOf("search-hit-variations.html") != -1 || previousPage.indexOf("booking-analysis-evolution.html") != -1 || previousPage.indexOf("booking-analysis-top-airlines.html") != -1 || previousPage.indexOf("booking-analysis-top-countries.html") != -1 || previousPage.indexOf("booking-analysis-top-onds.html") != -1 || previousPage.indexOf("booking-analysis-total.html") != -1 || previousPage.indexOf("por-search.html") != -1 || previousPage.indexOf("pos-search.html") != -1 || previousPage.indexOf("airline-search.html") != -1 || previousPage.indexOf("booking-market-search.html") != -1) {    
      url = "https://demo.travel-intelligence.com/api/v1/";
      if (previousPage.indexOf("search-look-hits.html") != -1) {
        url = url + 'search_look_hits';
      }
      else if (previousPage.indexOf("search-travel-hits.html") != -1) {
        url = url + 'search_travel_hits';
      }
      else if (previousPage.indexOf("search-hit-evolutions.html") != -1) {
        url = url + 'search_hit_evolutions';
      }
      else if (previousPage.indexOf("search-hit-variations.html") != -1) {
        url = url + 'search_hit_variations';
      }
      else if (previousPage.indexOf("booking-analysis-evolution.html") != -1) {
        url = url + 'booking_agency_evolutions';
      }
      else if (previousPage.indexOf("booking-analysis-top-airlines.html") != -1) {
        url = url + 'booking_agency_airlines';
      }
      else if (previousPage.indexOf("booking-analysis-top-countries.html") != -1) {
        url = url + 'booking_agency_countries';
      }
      else if (previousPage.indexOf("booking-analysis-top-onds.html") != -1) {
        url = url + 'booking_agency_onds';
      }
      else if (previousPage.indexOf("booking-analysis-total.html") != -1) {
        url = url + 'booking_agency_totals';
      }
      else if (previousPage.indexOf("por_search.html") != -1) {
        url = url + 'por_searches';
      }
      else if (previousPage.indexOf("pos_search.html") != -1) {
        url = url + 'pos_searches';
      }
      else if (previousPage.indexOf("airline_search.html") != -1) {
        url = url + 'airline_searches';
      }
      else if (previousPage.indexOf("booking-market-search.html") != -1) {
        url = url + 'booking_market_searches';
      }
    }
    else if (previousPage.indexOf("pricebenchmark_advancedpurchase.html") != -1 || previousPage.indexOf("pricebenchmark_bestpriceairline.html") != -1 || previousPage.indexOf("pricebenchmark_farenegotiation.html") != -1 || previousPage.indexOf("pricebenchmark_fareparams.html") != -1 || previousPage.indexOf("pricebenchmark_fareprojection.html") != -1 || previousPage.indexOf("pricebenchmark_faresnapshot.html") != -1 || previousPage.indexOf("pricebenchmark_purchasesnapshot.html") != -1) {    
      url = "https://qsi.travel-intelligence.com/ti-faremonitoring/api/";
      if (previousPage.indexOf("pricebenchmark_advancedpurchase.html") != -1) {
        url = url + 'advancedpurchase';
      }
      else if (previousPage.indexOf("pricebenchmark_bestpriceairline.html") != -1) {
        url = url + 'bestpriceairline';
      }
      else if (previousPage.indexOf("pricebenchmark_farenegotiation.html") != -1) {
        url = url + 'farenegotiation';
      }
      else if (previousPage.indexOf("pricebenchmark_fareparams.html") != -1) {
        url = url + 'fareparams';
      }
      else if (previousPage.indexOf("pricebenchmark_fareprojection.html") != -1) {
        url = url + 'fareprojection';
      }
      else if (previousPage.indexOf("pricebenchmark_faresnapshot.html") != -1) {
        url = url + 'faresnapshot';
      }
      else if (previousPage.indexOf("pricebenchmark_purchasesnapshot.html") != -1) {
        url = url + 'purchasesnapshot';
      }
    }

    url = url + "?";

    for (var i=0, j=0; i<form.length; i++)
    {
      if (form.elements[i].name != "" && form.elements[i].value !="") {
        if (j>0) {url = url + "&"}
        url = url + form.elements[i].name + "=";
        url = url + form.elements[i].value;
        j++;
      }
    }
    // Set the url in the corresponding frame
    var frameURL = document.getElementById('urlFrame');
    frameURL.contentDocument.body.style.fontSize = "10px";
    frameURL.contentDocument.body.style.fontFamily = "verdana, sans-serif";
    frameURL.contentDocument.body.innerHTML = url;
    // Set the result in the corresponding frame
    $.getJSON(url, function(data) {
      var jsonString = JSON.stringify(data, null, '\t');
      frameRes.contentDocument.body.innerHTML = jsonString;
    }).fail(function(jqXHR, textStatus, errorThrown) {
      frameRes.contentDocument.body.innerHTML ='JSON request failed! ' + errorThrown;
    })
  }
}
</script>